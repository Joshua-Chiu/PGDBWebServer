{% extends 'data/base.html' %}
{% load has_group %}
{% load staticfiles %}
{% load mathfilters %}

{% block title %}{{ student.first }} {{ student.last }}{% endblock %}

{% block stylesheet %}
    <link rel="stylesheet" href="{% static 'css/studentinfo_style.css' %}">
    <link rel="stylesheet" href="{% static 'css/collapsible_style.css' %}">
{% endblock %}

{% block content%}
    {% now "Y" as current_year %}
    {% now "n" as current_month %}
    <!--Student Info-->
    <h2><strong><a>{{ student.last }}, {{ student.first }} ({{ student.legal }})</a></strong></h2>
    <p style="font-size:20px"> Student #: <strong>{{ student.student_num }}</strong> | Homeroom: <strong>{{ student.homeroom }}</strong> | Sex: <strong>{{ student.sex }}</strong> | Grad Year: <strong>{{ student.grad_year}}</strong> | <a href="{% url 'admin:data_student_change' student.id %}">Edit</a></p>
    <hr>
    <form action="{% url "data:student_submit" student.id %}" id="form0" name="col form" method="post">
    {%csrf_token%}
    {% if user.is_superuser or user.can_view %}
        {% for i in i|rjust:5 %}
            {% for grade in student.grade_set.all %}
                {% ifequal 12|sub:forloop.parentloop.counter0 grade.grade|stringformat:"02d"|add:"0" %}
                    {% include 'data/collapsible.html' with student=student grade=grade.grade|stringformat:"02d" year=current_year month=current_month|floatformat:"0" grade_object=grade current_grade=student.homeroom|slice:":2" scholar=grade.scholar_set.all.0 %}
                {% endifequal %}
            {% endfor %}
        {% endfor %}
    {% else %}
        <div style="clear: both;"><h3>My Entries</h3></div>
        {% if request.user|has_group:"Service" %}
            {% include 'entry/overview.html' with type='SE' grade=student.grade_set.all.0 %}
        {% endif %}
        {% if request.user|has_group:"Athletics" %}
            {% include 'entry/overview.html' with type='AT' grade=student.grade_set.all.0 %}
        {% endif %}
        {% if request.user|has_group:"Scholar" %}
            {% include 'entry/overview.html' with type='SC' grade=student.grade_set.all.0 %}
        {% endif %}
        {% if request.user|has_group:"Fine Arts" %}
            {% include 'entry/overview.html' with type='FA' grade=student.grade_set.all.0 %}
        {% endif %}
    {% endif %}


    </form>
{% endblock %}

{% block javascript %}
<!--Script for the getting post requests-->
<script>
function submitForms() {
    document.getElementById("form0").submit();
    //document.getElementById("form 08").submit();
    //document.getElementById("form 09").submit();
    //document.getElementById("form 10").submit();
    //document.getElementById("form 11").submit();
    //document.getElementById("form 12").submit();
    }
function post(path, params, method) {
    method = method || "post"; // Set method to post by default if not specified.

    // The rest of this code assumes you are not using a library.
    // It can be made less wordy if you use one.
    var form = document.createElement("form");
    form.setAttribute("method", method);
    form.setAttribute("action", path);

    for(var key in params) {
        if(params.hasOwnProperty(key)) {
            var hiddenField = document.createElement("input");
            hiddenField.setAttribute("type", "hidden");
            hiddenField.setAttribute("name", key);
            hiddenField.setAttribute("value", params[key]);

            form.appendChild(hiddenField);
        }
    }

    document.body.appendChild(form);
    form.submit();
}
</script>

<!--prevent submit or query from changing field-->
<script>
    let wasEmpty = false;
    $(function(){
        $('.scholar').keyup(function(e){
            if(this.value.length >= 6 && wasEmpty){
                if(parseFloat(this.value) <= this.max){
                    submitForms();
                }
            }
            if(this.value.length < 6){
            wasEmpty = true;
            }
            if(e.which === 42){
                query.focus();
                return false;
            }
        });
    });
</script>

<script>
    $(document).ready(function () {
        $('input').keydown(function (e) {
            if (e.keyCode === 39) {
                $(this).next('input').focus();
            }
        });
    });
    $(".inputs").keyup(function () {
        if (this.value.length === this.maxLength && parseFloat(this.value) <= this.max) {
          $(this).next('.codes').focus();
        }
    });
    $(".codes").keyup(function () {
        if (this.value.length === this.maxLength) {
          submitForms();
          this.value = "";
        }
    });

</script>
<script>
function validateForm() {


}
</script>
{% endblock %}
